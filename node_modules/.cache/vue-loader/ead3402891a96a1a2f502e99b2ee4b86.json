{"remainingRequest":"D:\\2021graduate\\graduation\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\2021graduate\\graduation\\src\\views\\myaudio.vue?vue&type=style&index=0&id=11e40380&lang=less&scoped=true&","dependencies":[{"path":"D:\\2021graduate\\graduation\\src\\views\\myaudio.vue","mtime":1611493095756},{"path":"D:\\2021graduate\\graduation\\node_modules\\css-loader\\dist\\cjs.js","mtime":1594033219529},{"path":"D:\\2021graduate\\graduation\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1594033220124},{"path":"D:\\2021graduate\\graduation\\node_modules\\postcss-loader\\src\\index.js","mtime":1594033219961},{"path":"D:\\2021graduate\\graduation\\node_modules\\less-loader\\dist\\cjs.js","mtime":1594035188944},{"path":"D:\\2021graduate\\graduation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1594033213228},{"path":"D:\\2021graduate\\graduation\\node_modules\\vue-loader\\lib\\index.js","mtime":1594033220124}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoudXBsb2FkewogIHBhZGRpbmc6IDE0MHB4IDM2cHggMTYwcHggMzZweDsKICBib3gtc2l6aW5nOiBib3JkZXItYm94Owp9CgouZm9yUHJldmlld192aWRlb3sKICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgLypiYWNrZ3JvdW5kOiByZ2JhKDAsMCwwLC43KTsqLwogIHZpZGVvewogICAgd2lkdGg6IDk1JTsKICAgIG1heC1oZWlnaHQ6IDQzMHB4OwogIH0KICAuZGVsdGV7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICByaWdodDogMDsKICAgIGJvdHRvbTogMDsKICB9Cn0KLmZvclByZXZpZXdfZG9jLCAuZm9yUHJldmlld19hdWRpb3sKICBkaXNwbGF5OiBmbGV4OwogIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBpbWd7CiAgICB3aWR0aDogNTZweDsKICAgIGhlaWdodDogNTZweDsKICAgIG1hcmdpbi1yaWdodDogMjBweDsKICB9CiAgc3BhbjpudGgtb2YtdHlwZSgxKXsKICAgIGZsZXg6IDE7CiAgfQogIHNwYW46bnRoLW9mLXR5cGUoMil7CiAgICBtYXJnaW4tcmlnaHQ6IDIwcHg7CiAgfQp9Ci5mb3JQcmV2aWV3X3BpY3sKICBkaXNwbGF5OiBmbGV4OwogIGFsaWduLWl0ZW1zOiBmbGV4LWVuZDsKICBpbWd7CiAgICB3aWR0aDogMTYwcHg7CiAgICBoZWlnaHQ6IDE2MHB4OwogIH0KfQoKLmRpeS1kZXRhaWx7CiAgd2lkdGg6IDEwMCU7CiAgb3ZlcmZsb3c6IGhpZGRlbjsKCiAgLmJ0bnsKICAgIHNwYW57CiAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7CiAgICB9CiAgfQogIC52YW4tY2VsbHsKICAgIGJhY2tncm91bmQtY29sb3I6ICNGMEYwRjA7CiAgICBib3JkZXItcmFkaXVzOiAzNXB4OwogICAgZm9udC1zaXplOiAyNnB4OwogICAgaGVpZ2h0OiA2OXB4OwogICAgbGluZS1oZWlnaHQ6IDY5cHg7CiAgICBwYWRkaW5nOiAwIDIycHg7CiAgICBjb2xvcjogIzk5OTsKICB9CiAgLnZhbi1oYWlybGluZS0tdG9wLWJvdHRvbTo6YWZ0ZXIsIC52YW4taGFpcmxpbmUtdW5zZXQtLXRvcC1ib3R0b206OmFmdGVyIHsKICAgIGJvcmRlci13aWR0aDogMDsKICB9CiAgcHsKICAgIGhlaWdodDogNjRweDsKICAgIGxpbmUtaGVpZ2h0OiA2NHB4OwogICAgZm9udC1zaXplOiAzMnB4OwogICAgY29sb3I6ICMzMzM7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICBwYWRkaW5nLWxlZnQ6IDE2cHg7CiAgfQogIHA6OmJlZm9yZXsKICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgIHRvcDogMDsKICAgIGxlZnQ6IDA7CiAgICBjb250ZW50OiAnKic7CiAgICBjb2xvcjogI0ZGMDAwMDsKICB9CgogIHNwYW57CiAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgICB3aWR0aDogMTU3cHg7CiAgICBiYWNrZ3JvdW5kOiAjRjBGMEYwOwogICAgYm9yZGVyLXJhZGl1czogMzVweDsKICAgIGNvbG9yOiAjOTk5OwogICAgZm9udC1zaXplOiAyNnB4OwogICAgcGFkZGluZzogMTRweCAxOHB4OwogICAgbWFyZ2luLXJpZ2h0OiAyOHB4OwogICAgdGV4dC1hbGlnbjogY2VudGVyOwogIH0KICAuYWN0aXZlewogICAgY29sb3I6ICNmZmY7CiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gcmlnaHQsI0ZENTEzMCwjRkE2QzM0KTsKICB9Cn0KLmRpeS1zdWJtaXQgewogIHBvc2l0aW9uOiBmaXhlZDsKICBoZWlnaHQ6IDE1MHB4OwogIHdpZHRoOiA5MCU7CiAgYm90dG9tOiAwOwogIGJhY2tncm91bmQ6ICNmZmY7CgogIC52YW4tYnV0dG9uIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiA5MHB4OwogICAgYm9yZGVyLXJhZGl1czogNDVweDsKICAgIGZvbnQtc2l6ZTogMzZweDsKICAgIGNvbG9yOiAjZmZmOwogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KHRvIHJpZ2h0LCAjRkQ1MTMwLCAjRkE2QzM0KTsKICAgIHRvcDogNTAlOwogICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoMCwgLTUwJSk7CiAgfQogIC52YW4tYnV0dG9uLS1kZWZhdWx0IHsKICAgIGJvcmRlcjogbm9uZTsKICB9Cn0K"},{"version":3,"sources":["myaudio.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoNA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"myaudio.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div>\r\n    <v-header :left-text=\"`上传${columnName}`\"></v-header>\r\n\r\n    <div class=\"upload\">\r\n      <div v-if=\"columnName === '视频'\">\r\n        <div class=\"forPreview_video\" v-for=\"(item, index) in uploadVideoList\" :key=\"index\">\r\n          <video :src=\"videoSrc\"></video>\r\n          <van-icon name=\"delete\" @click=\"delBtn(index)\" class=\"delte\"/>\r\n        </div>\r\n        <van-uploader v-show=\"uploadVideoList.length < 2\" preview-size=\"80px\" accept=\"video/*\" :before-read=\"beforeRead\" :after-read=\"afterRead\"></van-uploader>\r\n      </div>\r\n\r\n      <div v-if=\"columnName === '文档'\">\r\n        <div class=\"forPreview_doc\" v-for=\"(item, index) in uploadDocList\" :key=\"index\">\r\n          <img src=\"../../assets/img/resource_doc_b@2x.png\" alt=\"\">\r\n          <span>{{item.name}}</span>\r\n          <span>{{item.size | formatSize}}</span>\r\n          <van-icon name=\"delete\" @click=\"delBtn(index)\" class=\"delte\"/>\r\n        </div>\r\n        <van-uploader v-show=\"uploadDocList.length < 2\" preview-size=\"80px\" accept=\".doc, .docx, .xml, .xlsx, .pdf\" :before-read=\"beforeRead\" :after-read=\"afterRead\"></van-uploader>\r\n      </div>\r\n\r\n      <div v-if=\"columnName === '音频'\">\r\n        <div class=\"forPreview_audio\" v-for=\"(item, index) in uploadAudioList\" :key=\"index\">\r\n          <img src=\"../../assets/img/resource_audio@2x.png\" alt=\"\">\r\n          <span>{{item.name}}</span>\r\n          <span>{{item.size | formatSize}}</span>\r\n          <van-icon name=\"delete\" @click=\"delBtn(index)\" class=\"delte\"/>\r\n        </div>\r\n        <van-uploader v-show=\"uploadAudioList.length < 2\" preview-size=\"80px\" accept=\"audio/*\" :before-read=\"beforeRead\" :after-read=\"afterRead\"></van-uploader>\r\n      </div>\r\n\r\n      <div v-if=\"columnName === '图片'\">\r\n        <div class=\"forPreview_pic\" v-for=\"(item, index) in uploadPicList\" :key=\"index\">\r\n          <img :src=\"picSrc\" alt=\"\">\r\n          <van-icon name=\"delete\" @click=\"delBtn(index)\" class=\"delte\"/>\r\n        </div>\r\n        <van-uploader v-show=\"uploadPicList.length < 2\" accept=\"image/*\" preview-size=\"80px\" :before-read=\"beforeRead\" :after-read=\"afterRead\"></van-uploader>\r\n      </div>\r\n\r\n      <div class=\"diy-submit\">\r\n        <van-button @click=\"doSubmit($event)\">提交</van-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport VHeader from '../../common/header'\r\nimport { uploadFile, addResources } from '../../http/mock'\r\nimport Toast from 'vant'\r\nexport default {\r\n  name: 'uploadFile',\r\n  components: {\r\n    VHeader\r\n  },\r\n  data () {\r\n    return {\r\n      tagList: [],\r\n      uploadTitle: '',\r\n      currentTag: null,\r\n      tagId: null,\r\n      columnName: localStorage.getItem('columnName'),\r\n      fileIdArr: [],\r\n\r\n      uploadVideoList: [], // 选中的上传视频列表\r\n      videoSrc: '', // 选中的视频的src，用来显示视频\r\n      uploadDocList: [], // 选中的上传文档列表\r\n      uploadAudioList: [], // 选中的上传音频列表\r\n      uploadPicList: [], // 选中的上传图片列表\r\n      picSrc: '' // 选中的图片的src，用来显示图片缩略图\r\n    }\r\n  },\r\n  filters: {\r\n    formatSize (val) { // 格式化文件大小\r\n      if (val > 0) {\r\n        return (val / 1024 / 1024).toFixed(2) + 'M'\r\n      } else {\r\n        return '0M'\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    // vant上传文件前校验文件事件\r\n    // 文件选中后先提交给后台，后台根据选中的文件，返回数组（这一业务根据后台而定）\r\n    beforeRead (file) {\r\n      const formData = new FormData() // 为上传文件定义一个formData对象\r\n      const config = {\r\n        headers: {\r\n          'Content-Type': 'multipart/form-data'\r\n        }\r\n      }\r\n      const uploadUrl = URL.createObjectURL(file) // 将选中的上传文件转化为二进制文件，显示在页面上\r\n      if (this.columnName === '视频') {\r\n        this.uploadVideoList.push(file)\r\n        this.videoSrc = uploadUrl\r\n        // 这里使用foreach是为了将选中的多个文件都添加进定义的formdata变量中\r\n        this.uploadVideoList.forEach(item => {\r\n          formData.append(item.name, item)\r\n        })\r\n      } else if (this.columnName === '文档') {\r\n        this.uploadDocList.push(file)\r\n        this.uploadDocList.forEach(item => {\r\n          formData.append(item.name, item)\r\n        })\r\n      } else if (this.columnName === '音频') {\r\n        this.uploadAudioList.push(file)\r\n        this.uploadAudioList.forEach(item => {\r\n          formData.append(item.name, item)\r\n        })\r\n      } else if (this.columnName === '图片') {\r\n        this.uploadPicList.push(file)\r\n        this.picSrc = uploadUrl\r\n        this.uploadPicList.forEach(item => {\r\n          formData.append(item.name, item)\r\n        })\r\n      }\r\n\r\n      // formData.append(file.name, file); // 单个文件上传时可以这么写，上面的foreach就可以删掉\r\n      this.$api.post(uploadFile, formData, config).then(res => {\r\n        this.fileIdArr = res.data.data // 把選中的文件傳送給後台\r\n      }).catch(err => {\r\n        Toast('文件上傳失敗！')\r\n        console.log(err)\r\n      })\r\n    },\r\n    // 删除待上传的文件\r\n    delBtn (index) {\r\n      if (this.columnName === '视频') {\r\n        // 先判断当前的选中的索引是否是在有效范围中，如果不是则跳出方法\r\n        if (isNaN(index) || index >= this.uploadVideoList.length) {\r\n          return false\r\n        }\r\n        const tmp = []\r\n        // 将没被选中的上传文件存放进一个临时数组中\r\n        for (let i = 0; i < this.uploadVideoList.length; i++) {\r\n          if (this.uploadVideoList[i] !== this.uploadVideoList[index]) {\r\n            tmp.push(this.uploadVideoList[i])\r\n          }\r\n        }\r\n        // 存放当前未被选中的上传文件\r\n        this.uploadVideoList = tmp\r\n      }\r\n\r\n      if (this.columnName === '文档') {\r\n        console.log(this.uploadDocList.length)\r\n        if (isNaN(index) || index >= this.uploadDocList.length) {\r\n          return false\r\n        }\r\n        const tmp = []\r\n        for (let i = 0; i < this.uploadDocList.length; i++) {\r\n          if (this.uploadDocList[i] !== this.uploadDocList[index]) {\r\n            tmp.push(this.uploadDocList[i])\r\n          }\r\n        }\r\n        this.uploadDocList = tmp\r\n      }\r\n\r\n      if (this.columnName === '音频') {\r\n        if (isNaN(index) || index >= this.uploadAudioList.length) {\r\n          return false\r\n        }\r\n        const tmp = []\r\n        for (let i = 0; i < this.uploadAudioList.length; i++) {\r\n          if (this.uploadAudioList[i] !== this.uploadAudioList[index]) {\r\n            tmp.push(this.uploadAudioList[i])\r\n          }\r\n        }\r\n        this.uploadAudioList = tmp\r\n      }\r\n\r\n      if (this.columnName === '图片') {\r\n        if (isNaN(index) || index >= this.uploadPicList.length) {\r\n          return false\r\n        }\r\n        console.log('uuu')\r\n        const tmp = []\r\n        for (let i = 0; i < this.uploadPicList.length; i++) {\r\n          if (this.uploadPicList[i] !== this.uploadPicList[index]) {\r\n            tmp.push(this.uploadPicList[i])\r\n          }\r\n        }\r\n        this.uploadPicList = tmp\r\n      }\r\n    },\r\n    doSubmit () {\r\n      const params = {\r\n        classify: this.tagId, // 针对视频资源时对应的分类id\r\n        file: this.fileIdArr, // 选择完文件后，调用uploadFile这个接口，后端返回的数组\r\n        resourceColumnId: JSON.parse(localStorage.getItem('columnId')), // 资源栏目id(视频、图片、音频、文档)\r\n        title: this.uploadTitle // 上传时填写的标题\r\n      }\r\n      const columnName = localStorage.getItem('columnName')\r\n      this.$api.post(addResources, params).then(res => {\r\n        if (res.data.code === 1001) {\r\n          if (columnName === '视频') {\r\n            this.$router.push({ name: 'myVideo' })\r\n          } else {\r\n            this.$router.push({ name: 'myResourceClassify' })\r\n          }\r\n        }\r\n      }).catch(err => {\r\n        console.log(err)\r\n      })\r\n    }\r\n  },\r\n  mounted () {\r\n    this.getClassifyList()\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n  .upload{\r\n    padding: 140px 36px 160px 36px;\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  .forPreview_video{\r\n    position: relative;\r\n    /*background: rgba(0,0,0,.7);*/\r\n    video{\r\n      width: 95%;\r\n      max-height: 430px;\r\n    }\r\n    .delte{\r\n      position: absolute;\r\n      right: 0;\r\n      bottom: 0;\r\n    }\r\n  }\r\n  .forPreview_doc, .forPreview_audio{\r\n    display: flex;\r\n    margin-bottom: 10px;\r\n    align-items: center;\r\n    img{\r\n      width: 56px;\r\n      height: 56px;\r\n      margin-right: 20px;\r\n    }\r\n    span:nth-of-type(1){\r\n      flex: 1;\r\n    }\r\n    span:nth-of-type(2){\r\n      margin-right: 20px;\r\n    }\r\n  }\r\n  .forPreview_pic{\r\n    display: flex;\r\n    align-items: flex-end;\r\n    img{\r\n      width: 160px;\r\n      height: 160px;\r\n    }\r\n  }\r\n\r\n  .diy-detail{\r\n    width: 100%;\r\n    overflow: hidden;\r\n\r\n    .btn{\r\n      span{\r\n        margin-bottom: 10px;\r\n      }\r\n    }\r\n    .van-cell{\r\n      background-color: #F0F0F0;\r\n      border-radius: 35px;\r\n      font-size: 26px;\r\n      height: 69px;\r\n      line-height: 69px;\r\n      padding: 0 22px;\r\n      color: #999;\r\n    }\r\n    .van-hairline--top-bottom::after, .van-hairline-unset--top-bottom::after {\r\n      border-width: 0;\r\n    }\r\n    p{\r\n      height: 64px;\r\n      line-height: 64px;\r\n      font-size: 32px;\r\n      color: #333;\r\n      position: relative;\r\n      padding-left: 16px;\r\n    }\r\n    p::before{\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      content: '*';\r\n      color: #FF0000;\r\n    }\r\n\r\n    span{\r\n      display: inline-block;\r\n      width: 157px;\r\n      background: #F0F0F0;\r\n      border-radius: 35px;\r\n      color: #999;\r\n      font-size: 26px;\r\n      padding: 14px 18px;\r\n      margin-right: 28px;\r\n      text-align: center;\r\n    }\r\n    .active{\r\n      color: #fff;\r\n      background: linear-gradient(to right,#FD5130,#FA6C34);\r\n    }\r\n  }\r\n  .diy-submit {\r\n    position: fixed;\r\n    height: 150px;\r\n    width: 90%;\r\n    bottom: 0;\r\n    background: #fff;\r\n\r\n    .van-button {\r\n      width: 100%;\r\n      height: 90px;\r\n      border-radius: 45px;\r\n      font-size: 36px;\r\n      color: #fff;\r\n      background: linear-gradient(to right, #FD5130, #FA6C34);\r\n      top: 50%;\r\n      transform: translate(0, -50%);\r\n    }\r\n    .van-button--default {\r\n      border: none;\r\n    }\r\n  }\r\n</style>\r\n"]}]}